<!doctype html>
<html class="no-js" lang="">

<head>
  <meta charset="utf-8">
  <title></title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="manifest" href="site.webmanifest">
  <link rel="apple-touch-icon" href="icon.png">
  <!-- Place favicon.ico in the root directory -->

  <link rel="stylesheet" href="./css/normalize.css">
  <link rel="stylesheet" href="./css/main.css">
  <link rel="stylesheet" href="./css/portfolio.css">
  <link href="https://fonts.googleapis.com/css?family=Audiowide|Bitter|Dosis|Indie+Flower|Josefin+Sans|Merriweather+Sans|Permanent+Marker|Shadows+Into+Light&display=swap" rel="stylesheet">

  <meta name="theme-color" content="#fafafa">
</head>

<body>
  <!--[if IE]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->

  <!-- Add your site or application content here -->
    <div id="menu-bar" class="marker">
        <div class="masthead">
            <div class="siteName">JecT</div>
            <div class="subtitle">An interactive project journal</div>
        </div>
        <ul>
            <li><a class="hover" id="contact">Contact</a></li>
            <li><a class="hover" id="books">Books</a></li>
            <li><a class="hover" id="notes">Notes</a></li>
            <li><a class="hover" id="projects">Projects</a></li>
            <li><a class="hover" id="home">Home</a></li>
        </ul>
    </div>

    <div id="display">
        <div id="image-wrapper">
            <div id="edit-hero-image" class='noshow'>
                Edit
            </div>
            <div id="hero-image"></div>
        </div>

        <div id="title-wrapper">
            <div id="edit-title" class=''>
                Edit
            </div>
            <div id="title"></div>
        </div>
        <div id="description-wrapper" class="hide-scroll">
            <div id="add-description" class='noshow'>
                +
            </div>
            <div id="description"></div>
        </div>
        <div id="newsfeed-wrapper" class="hide-scroll">
            <div id="add-newsfeed" class='noshow'>
                +
            </div>
            <div id="newsfeed"></div>
        </div> 
    </div>

    <div id="scroll-wrapper" class="hide-scroll">
        <div id="add-scroll" class="noshow">
            +
        </div>
        <div id="scroll"></div>
    </div>
  

  <script src="./js/vendor/modernizr-3.7.1.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
  <script>window.jQuery || document.write('<script src="./js/vendor/jquery-3.4.1.min.js"><\/script>')</script>
  <script src="./js/plugins.js"></script>
  <script src="./js/main.js"></script>
  <script src="./js/note.js"></script>
  <script src="./js/blogPost.js"></script>
  <script src="./js/project.js"></script>
  <script src="./js/portfolio.js"></script>
  <script src="./js/booksDB.js"></script>

  <script type="text/javascript">
    // Never invest a ton of time into designing specifics for something with high probability of change
    let descriptionText = " Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras ornare in libero hendrerit dictum. Proin luctus justo id convallis iaculis. Etiam a diam vitae est viverra maximus. Aliquam metus ipsum, euismod non faucibus at, suscipit a dolor. Duis in elit et quam semper commodo quis eu elit. Sed sit amet volutpat erat, eget interdum nisi. Morbi dictum tellus efficitur justo interdum, vitae ultrices nulla lobortis. Donec blandit diam nec auctor eleifend. Pellentesque auctor, nisl et tempor sodales, sem velit finibus dui, molestie convallis purus elit nec justo. Maecenas porttitor interdum congue. Proin ultricies sapien quis ex pretium, nec placerat nunc placerat. Etiam eleifend mauris eget tortor lacinia, eu facilisis risus gravida. Nullam iaculis risus diam, vel pellentesque velit pellentesque vel. Etiam auctor, libero et malesuada vehicula, justo elit pulvinar orci, a sagittis purus augue non ipsum. Integer sed aliquam arcu. Nunc auctor eros ligula, ut elementum leo pharetra eget. Nam justo ipsum, consequat ut bibendum non, fringilla a mauris. Donec facilisis leo vitae urna commodo, ut varius dui hendrerit. Praesent feugiat ligula at rhoncus convallis. Quisque porttitor in dolor in ullamcorper. Sed sed diam nec sapien viverra placerat. Etiam elementum venenatis est, ac volutpat lectus consequat a. Ut placerat consequat faucibus. Praesent dictum ultricies sapien, id ullamcorper dolor rhoncus id. Etiam ipsum lorem, interdum a porttitor vitae, finibus vitae odio. Mauris tincidunt tempus mi, molestie finibus velit ornare eget. Morbi condimentum vitae nunc ac sollicitudin. Sed pulvinar, lorem sed consequat eleifend, mi metus tempor nisi, commodo tempor enim lorem non ex. Etiam interdum nunc nec mattis tincidunt. Sed consectetur pellentesque mattis. "
    let dummyNewsfeed = [];
    let dummyNotes = [];
    dummyNotes.push(new Project("Finding an idea", null, "https://cdn.dribbble.com/users/476251/screenshots/2619255/attachments/523315/placeholder.png", "How I found idea", []));

    // New post database
    let projects = [
        {title: "Platoon Dynamics", description: "A Decision Platform for HDVs", imgPath: "./res/platoonDynamics/imgs/icon.png", newsfeed: dummyNewsfeed},
        {title: "No Script For You!", description: "A RNN for generating Seinfeld Scripts", imgPath: "./res/noScriptForYou/imgs/noScriptForYou.png", newsfeed: dummyNewsfeed},
        {title: "Threads", description: "A Web Based Notebooking Tool", imgPath: "./res/threads/imgs/threads.png", newsfeedDiv: dummyNewsfeed},
        {title: "OkEmoji", description: "Maps People's Emoji Responses in Your Vicinity. Won Best First Hack at HackNY some years back", imgPath: "./res/okEmoji/imgs/okEmoji.png", newsfeed: dummyNewsfeed},
        {title: "Noted", description: "A tool for sharing ideas with friends and mapping concepts (Predecessor to threads)", imgPath: "./res/noted/imgs/noted.png", newsfeed: dummyNewsfeed},
        {title: "This Website!", description: "Attempt at making an online progress journal for myself.", imgPath: "./res/personalSite/imgs/personalSite.png", newsfeed: dummyNewsfeed},
    ];

    // Notes
    let notes = [
      // new Project("Bioshock", "Both impressed and unimpressed with this game. Only half way (maybe?) through tho", []),
        new Project("Gaming", "See what I'm playing and what I think of it", "./res/notes/gaming/imgs/icon.jpg", "This year I've been focused on clearing out my backlog of steam games and as such have been spending a lot more time playing singleplayer story driven games. Maybe one day one of my own games will be on this list :D", [
            new Project("Limbo", "Enjoyable, but solemn and short.", "./res/notes/gaming/limbo/imgs/icon.jpg", "", []),
            new Project("Celeste", "A really well-made thoughtful platformer.", "./res/notes/gaming/celeste/imgs/icon.jpg", "", []),
            new Project("Psychonauts", "Haven't made my mind up on this one yet", "./res/notes/gaming/psychonauts/imgs/icon.jpg", "", []),
            new Project("Hollow Knight", "Is this a dark souls?", "./res/notes/gaming/hollowKnight/imgs/icon.jpg", "", []),
            new Project("Darkest Dungeon", "Stess testing the thought that people are a means to an ends", "./res/notes/gaming/darkestDungeon/imgs/icon.jpg", "", []),
            new Project("Team Fight Tactics", "Thought it was fun for a bit. But I've since moved on.", "./res/notes/gaming/tft/imgs/icon.jpg", "", []),
        ]),
        new Project("Watching", "See what I'm watching", "./res/notes/watching/imgs/icon.jpg", "A list of all the shows I've been watching this year and my general thoughts about them.", [
            new Project("Marvel's The Punisher", "Liked S1, lost interest in S2", "./res/notes/watching/punisher/imgs/icon.jpg", "", []),
            new Project("Breaking Bad", "I'm behind the times I know. I started it but couldn't really stay interested", "./res/notes/watching/breakingBad/imgs/icon.jpg", "", []),
            new Project("Neon Genesis Evangelion", "I've only seen one episode so far..", "./res/notes/watching/nge/imgs/icon.jpg", "", []),
            new Project("Dark", "A really good German show that's basically stranger things as a thriller. Recommend!", "./res/notes/watching/dark/imgs/icon.jpg", "", []),
        ]),
        new Project("Research", "A collection og papers I've read and some thoughts. Trying to get better at drawing knowledge from this resource", "./res/notes/research/imgs/icon.jpg", []),
    ];

    // Books
    let books = getBooksScrollBar();

    // Home
    let home = [
        new Project("Welcome to Ject!", "J. Patrick Taggart's project notebook!", "./img/cyberPunk.jpg", "Welcome to my website :D", []),
    ]

    let contact = [
        new Project("Contact me", "Email, and social media accounts", "./img/cyberPunk.jpg", "Coming soon :d", []),
        new Project("About me", "Who am I?", "./img/default.jpg", "Coming soon... I should put the thinker img here", []),
    ]

    let projectObjs = [];
    for (let i = 0; i < projects.length; i++) {
        projectObjs.push(new Project(projects[i].title, null, projects[i].imgPath, projects[i].description, dummyNotes));
    }

    function loadPage(projectObjs) {
        loadScrollBar(projectObjs);
        // Populate the display with the first project
        loadProject(projectObjs[0]);
    }

    // Setup click handlers for menu buttons
    let homeButton = document.getElementById("home");
    homeButton.addEventListener("click", function() {
        state.books = false;
        loadPage(home);
    });
    let notesButton = document.getElementById("notes");
    notesButton.addEventListener("click", function() {
        state.books = false;
        loadPage(notes);
    });
    let booksButton = document.getElementById("books");
    booksButton.addEventListener("click", function() {
        state.books = true; // TODO find better way to do this
        loadPage(books);
    });
    let projectsButton = document.getElementById("projects");
    projectsButton.addEventListener("click", function() {
        state.books = false;
        loadPage(projectObjs);
    });
    let contactButton = document.getElementById("contact");
    contactButton.addEventListener("click", function() {
        state.books = false;
        loadPage(contact);
    });
    loadPage(home);

    // First test call to backend
    var xhttp = new XMLHttpRequest();

    // Tabs represent the clickable menu items
    // TODO make these into promises
    function getTab(tabName) {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            // Load project using returned data
            console.log("Returned!");
            console.log(xhttp.responseText);
            console.log(JSON.parse(xhttp.responseText));

            // Should notes be included? (Would save on # requests but might be too much data. I definitely want notes for the project I'm loading in, but don't really need for others...)
                // Since I'll sometimes need it and sometimes wont ill just make it a param. but this might kinda be premature
            let projectList = JSON.parse(xhttp.responseText);
            fillProjects(projectList).then(function(filledProjects) {
                console.log("Filled projects");
                console.log(filledProjects);
                let projectObjs = wrapToProjects(filledProjects);
                loadPage(projectObjs);
            }).catch(err => console.log("ERROR In PROMISE - fillPROJECTS: " + err)); // Adds notes to each project
            let projectObjs = wrapToProjects(projectList);
            loadPage(projectObjs);
        }
        console.log("About to send request");
        xhttp.open("GET", "tab/load?tab=" + tabName, true);
        xhttp.send();
        console.log("Request sent");
    }

    function fillProjects(projects) {
        // TODO 
        let promises = [];
        for (let i = 0; i < projects.length; i++) {
            // promises.push(getNotes(projects[i]));
            promises.push(fillProject(projects[i]));
        }

        return Promise.all(promises);
    }

    function fillProject(pData) {
        return new Promise(function(resolve, reject) {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                // Load project using returned data
                console.log("Returned from fillProject call!");
                console.log(JSON.parse(xhttp.responseText));

                // Should notes be included? (Would save on # requests but might be too much data. I definitely want notes for the project I'm loading in, but don't really need for others...)
                    // Since I'll sometimes need it and sometimes wont ill just make it a param. but this might kinda be premature
                let fillData = JSON.parse(xhttp.responseText); // TODO - Going to need to add an error flag to return
                if (fillData.notes) {
                    console.log("Addding notes: " + fillData.notes);
                    let parsedNotes = wrapToNotes(fillData.notes);
                    pData.notes = parsedNotes;
                }
                if (fillData.subProjects) {
                    console.log("Adding sub projects: " + fillData.subProjects);
                    console.log(fillData.subProjects);
                    let parsedProjects = wrapToProjects(fillData.subProjects);
                    pData.subProjects = parsedProjects;
                }

                console.log("resolving with");
                console.log(pData);
                resolve(pData);
            }
            console.log("About to send request");
            xhttp.open("GET", "project/fill?pID=" + pData.pID, true);
            xhttp.send();
            console.log("Request sent");
        });
    }

    function getNotes(pData) {
        return new Promise(function(resolve, reject) {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                // Load project using returned data
                console.log("Returned from getNotes call!");
                console.log(JSON.parse(xhttp.responseText));

                // Should notes be included? (Would save on # requests but might be too much data. I definitely want notes for the project I'm loading in, but don't really need for others...)
                    // Since I'll sometimes need it and sometimes wont ill just make it a param. but this might kinda be premature
                let notes = JSON.parse(xhttp.responseText); // TODO - Going to need to add an error flag to return
                if (notes.length) {
                    let parsedNotes = wrapToNotes(notes);
                    pData.notes = parsedNotes;  // Add notes to project
                    resolve(pData);
                } else {
                    resolve(pData);
                }
                
            }
            console.log("About to send request");
            xhttp.open("GET", "project/fill?pID=" + pData.pID, true);
            xhttp.send();
            console.log("Request sent");
        });
    }

    function convertToNote(noteData) {
        return new Note(noteData.nID, noteData.content, noteData.createdAt, noteData.updatedAt);
    }

    function wrapToNotes(notes) {
        let noteObjs = [];
        for (let i = 0; i < notes.length; i++) {
            noteObjs.push(convertToNote(notes[i]));
        }

        // Error checking?
        return noteObjs;
    }

    function wrapToProjects(projectList) {
        console.log("Wrap2Project given data: " + projectList);
        let projectObjs = [];
        for (let i = 0; i < projectList.length; i++) {
            projectObjs.push(convertToProject(projectList[i]));
        }

        // Error checking?
        return projectObjs;
    }
    function convertToProject(pData) {
        // Input is JSON object of form: author, created, description, imgPath, pID, subtitle, title, updatedAt
        // Project obj is of form: title, subtitle, imgPath, description, noteList
                        //    id,   title,         subtitle,     imgPath,       description,       author,       createdAt,       updatedAt,       noteList,  subProjects
        return new Project(pData.pID, pData.title, pData.subtitle, pData.imgPath, pData.description, pData.author, pData.created, pData.updatedAt, pData.notes, pData.subProjects);
    }
    getTab("home");
  </script>

  <!-- Include stylesheet -->
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <!-- Include the Quill library -->
  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

  <!-- Google Analytics: change UA-XXXXX-Y to be your site's ID. -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-XXXXX-Y', 'auto'); ga('set','transport','beacon'); ga('send', 'pageview')
  </script>
  
  <script src="https://www.google-analytics.com/analytics.js" async></script>
</body>

</html>
